// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//enum role

enum Role {
  super_admin
  client_admin
  manager
  chauffeur
}
enum ContractType {
  CDI
  CDD
  Interimaire
  Stagiaire
}
enum Droits {
  consulter
  gerer
}
enum Etat {
  recu
  enAttente
  confirme
  refuse
}

enum EtatSinistre {
  En_cours
  Clos
}
enum EPA_declared {
  oui
  non
  ne_sais_pas
}
enum Jours {
  Lundi
  Mardi
  Mercredi
  Jeudi
  Vendredi
  Samedi
  Dimanche
}
enum intervalle_des_heures {
  Entre_3h_6h
  Entre_6h_9h
  Entre_9h_11h
  Entre_11h_13h
  Entre_15h_17h
  Entre_17h_19h
  Entre_19h_22h
  Entre_22h_3h
}
enum intervalle_de_temps_conduite {
  Moins_30min
  Entre_30min_1h
  Entre_1h_2h
  Entre_2h_3h
  Entre_3h_4h
  plus_4h
}

model User {
  id            Int          @id @default(autoincrement())
  email         String       @unique
  nom           String
  prenom        String
  mdp           String       @default("default")
  role          String
  aciveInactive Boolean      @default(true)
  profile       Profile?
  super_admin   SuperAdmin?
  admin_client  AdminClient?
  manager       Manager?
  chauffeur     Chauffeur?
}
model Profile {
  id                Int           @id @default(autoincrement())
  numTel            Int?
  date_de_naissance DateTime      @db.Date
  typeContrat       ContractType?
  dateEmbauche      DateTime?
  creerPar          Role          @default(manager)
  permisConduire    Bytes?
  picture           Bytes?
  user              User          @relation(fields: [userId], references: [id])
  userId            Int           @unique
}
model SuperAdmin {
  id      Int      @id @default(autoincrement())
  user    User     @relation(fields: [userId], references: [id])
  userId  Int      @unique
  clients Client[]
}
model AdminClient {
  id       Int    @id @default(autoincrement())
  user     User   @relation(fields: [userId], references: [id])
  userId   Int    @unique
  client   Client @relation(fields: [clientID], references: [id])
  clientID Int    @unique
}
model Manager {
  id       Int       @id @default(autoincrement())
  user     User      @relation(fields: [userId], references: [id])
  userId   Int       @unique
  droits   Droits
  societes Societe[]
}
model Chauffeur {
  id                     Int                     @id @default(autoincrement())
  email                String        @unique
  siteName               String
  region                 String
  user                   User                    @relation(fields: [userId], references: [id])
  userId                 Int                     @unique
  site                   Site                    @relation(fields: [siteId], references: [id])
  siteId                 Int                     @unique
  sinistres              Sinistre[]
  entretienPostAciidents EntretienPostAccident[]
  entretienVehicules     EntretienVehicule[]
}
model Client {
  id                   Int           @id @default(autoincrement())
  nomClient            String
  email                String        @unique
  numTel               String           @unique
  ville              String?
  codePostale              String?  @map("code postale")
  adresse              String?
  numAssistance        Int?
  descriptifAssistance String?       @db.VarChar(1000)
  nomDomaine           String
  numSiret             String?   
  nbreSociete          Int           @default(0)
  nbreSites            Int?          @default(0)
  nbreAdmins           Int?          @default(0)
  startDate            String?  
  endDate              String? 
  donneesCrypte        Boolean
  isActive             Boolean    @default(true)
  logo                 String?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime?     @updatedAt
  superAdmin           SuperAdmin    @relation(fields: [superAdminID], references: [userId])
  superAdminID         Int
  adminClients         AdminClient[]
  countrys             Country[]
  contrats Contrat[]
}
model Contrat {
  id                   Int                   @id @default(autoincrement())
  refContrat String
  Assureur String
  typeContrat String?
  startDate            String?  
  endDate              String? 
  Client             Client?                    @relation(fields: [ClientID], references: [id])
  ClientID           Int?
  Societe             Societe?                 @relation(fields: [SocieteID], references: [id])
  SocieteID           Int?
}
model Country {
  id       Int      @id @default(autoincrement())
  name     String
  client   Client   @relation(fields: [clientId], references: [id])
  clientId Int
  regions  Region[]
}
model Region {
  id        Int       @id @default(autoincrement())
  name      String
  country   Country   @relation(fields: [countryID], references: [id])
  countryID Int
  societes  Societe[]
}
model Societe {
  id         Int       @id @default(autoincrement())
  name       String
  email      String
  numTel     Int
  numSiret   Int?
  nmbreSites Int       @default(0)
  creerPar   Role
  isActive   Boolean
  region     Region    @relation(fields: [regionID], references: [id])
  regionID   Int       @unique
  managers   Manager[]
  sites      Site[]
  contrats Contrat[]
}
model Site {
  id           Int         @id @default(autoincrement())
  name         String
  adresse      String
  nbrChauffeur Int         @default(0)
  creerPar     Role
  isActive     Boolean
  societe      Societe     @relation(fields: [companyID], references: [id])
  companyID    Int         @unique
  chuaffeurs   Chauffeur[]
}

enum VehiculeTypeEnum {
  TRR
  SR
  VL
  Camion
}

enum CasSinistre {
Arret 
En_Circulation
Manoeuvre 
}
//@map("Arrêt")
// @map("En Circulation")
// @map("Manœuvre")
enum NatureSinistre {
  Etranger
  Corpo
  Non_Auto 
}
//@map("Non Auto")
enum DPMenum {
  Devis
  CG
  Permis
  Facture
  DC 
  PV
  Constat
}
//@map("Déclaration Chauffeur")
enum BolType {
  oui
  non
}


model Sinistre {
  id                   Int                    @id @default(autoincrement())
  etat                 Etat?                  @default(recu)
  chauffeur            Chauffeur?             @relation(fields: [chauffeurEmail], references: [email])
  chauffeurEmail       String?
  creatorRole          Role                   @map("créer par")
  creatorId            String                 @map("id créateur")
  createdAt            DateTime?              @default(now())
  updatedAt            DateTime               @default(now())
  declarationSinistre  DeclarationSinistre?
}

model DeclarationSinistre {
  sinistre                      Sinistre       @relation(fields: [Dossier], references: [id], onDelete: Cascade)
  Dossier                       Int            @unique
  DossierClient                 String?        @map("Dossier Client")
  NumClient                     String?       @map("Numéro Client")
  Annee                         String?          @map("Année")
  ASSUREUR                      String?
  numContart                    String?       @map("Numéro Contrat")
  Amiable                       String?
  ref_Sinistre                  String?       @map("Ref Sinistre Assureur")
  Date_recep                    String        @map("Date récep.")
  Date_Survenance               String        @map("Date Survenance.")
  Heure                         intervalle_des_heures?
  CAS                           CasSinistre?
  LIEU_SINISTRE                 String          @map("LIEU SINISTRE")
  SOCIETE_A_Facturer            String?        @map("SOCIETE")
  Site                          String?
  Region                        String?          @map("Région")
  Type_Vehicule                 VehiculeTypeEnum @map("Type Véhicule")
  Immatriculation               String           @map("Immatriculation")
  Marque                        String?
  premiere_MEC                  String @map("1ère MEC")
  Perte_Fi                      BolType? @map("Perte Fi")
  Conducteur                    String
  pourcentage_RC                String? @map("%RC")
  Cas_IDA                       String? @map("Cas IDA")
  Nature                        NatureSinistre?
  Circonstances                 String?         @db.Text
  Dommages                      String?
  Cie_adv                       String?  @map("Cie adv.")
  Conv                          BolType? @map("Conv.")
  Mt_Dom                        String? @map("Mt Dom.")
  Franchise                     String?
  Date_MISSIONNEMENT            String? @map("Date MISSIONNEMENT")
  Lieu_expertise                String? @map("Lieu expertise")
  Date_EXPERTISE                String? @map("Date EXPERTISE")
  Date_RAPPORT                  String? @map("Date RAPPORT")
  Ref_expertise                 String? @map("Ref expertise")
  Date_RAPPORT_DEFINITIF        String? @map("Date RAPPORT DEFINITIF")
  cout_expert                   String? @map("coût expert")
  REPARATION_oui_non            BolType? @map("REPARATION O/N")
  CESSION_EPAVE                 BolType? @map("CESSION/EPAVE")
  Mt_rec                        String? @map("Mt rec.")
  Pieces_manquantes_Oui_Non     BolType? @map("Pièces manquantes O/N")
  Detail_pieces_manquantes      DPMenum? @map("Détail pièces manquantes")
  Date_de_relance_pieces_M      String?   @map("Date de relance pièces M")
  Constat_original_O_N          BolType? @map("Constat original O/N")
  Date_clot                     String? @map("Date clot.")
  Charge_Provisionnelle_Solaris String?  @map("Charge Provisionnelle Solaris")
  Charge_ajustee                String?  @map("Charge ajustée")
  Charge_reelle                 String?  @map("Charge réelle")
  Etat                          EtatSinistre?  
  Commentaires                  String?         @db.Text
}
model EntretienPostAccident {
  id                                                              Int                          @id @default(autoincrement())
  // 1 - Identification
  societe                                                         String
  Entite                                                          String
  nom_prenom_chauffeur                                            String
  date_entree_dans_fonction                                       DateTime
  Contrat                                                         ContractType
  date_accident                                                   DateTime
  declare_a_assureur                                              EPA_declared
  date_entretien                                                  DateTime
  entretien_realisee_par                                          String
  // 2 - Jour de l’accident
  jour_de_survenance_de_accident                                  Jours
  Dernier_jour_de_pause_hebdomadaire                              Jours
  Heure_accident                                                  intervalle_des_heures
  Heure_prise_service                                             intervalle_des_heures
  temps_coduite_depuis_prise_servise_au_dernier_pause_obligatoire intervalle_de_temps_conduite
  // 3 - Type de véhicule
  Vehicule_habituel                                               Boolean
  type_de_vehicule                                                String
  chauffeur                                                       Chauffeur                    @relation(fields: [chauffeurID], references: [id])
  chauffeurID                                                     Int
  // 4 - Conditions de survenance
  meteo                                                           String //enum
  luminosite                                                      String //enum
  environement                                                    String //enum
  configuration                                                   String //enum
  type_de_voie                                                    String //enum
  type_de_tiers                                                   String //enum
  type_de_trajet                                                  String //enum
  Kilometres_parcourus_avant_le_sinistre                          String //enum
  Gestion_de_la_mission                                           String //enum
  //5 - Nature du sinistre
  Estimation_de_accident                                          String //enum
  Genre_du_sinistre                                               String //enum
  Degats                                                          String //enum
  // 6 - Impact sur le véhicule
  endroit_impact                                                  String //enum
  Expression_libre                                                String                       @db.Text
  // 7 - Situations de survenance
  Circonstance_de_accident                                        Int //enum 1..25
  Evitabilite_de_accident                                         Int // enum 1..7
  ifacteur_nfluence_survenance_accident                           Int // enum 1..6
  Avis_Evitable_O_N                                               Boolean
  Signature_responsable                                           Bytes
  Signature_Conducteur                                            Bytes
}
model EntretienVehicule {
  id                    Int       @id @default(autoincrement())
  etat                  String // reçu/ en cours / confirmé / refus
  resultat_entretien    String
  description_entretien String    @db.Text
  type_vehicule         String
  matricule             String
  chauffeur             Chauffeur @relation(fields: [chauffeurID], references: [id])
  chauffeurID           Int
}
